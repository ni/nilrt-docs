
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tracing on NI Linux Real-Time &#8212; nilrt-docs 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=5283bb3d" />
    
    <script src="../_static/documentation_options.js?v=a681ed88"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="USB-Based System Replication" href="../system_replication/system_replication.html" />
    <link rel="prev" title="Technical Support Report" href="technicalreport.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../system_replication/system_replication.html" title="USB-Based System Replication"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="technicalreport.html" title="Technical Support Report"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="troubleshooting_index.html" accesskey="U">NI Linux Real-Time Debug Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing on NI Linux Real-Time</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tracing-on-ni-linux-real-time">
<h1>Tracing on NI Linux Real-Time<a class="headerlink" href="#tracing-on-ni-linux-real-time" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#ftrace" id="id3">ftrace</a></p></li>
<li><p><a class="reference internal" href="#extract-the-trace" id="id4">Extract the trace</a></p></li>
<li><p><a class="reference internal" href="#analyze-the-results" id="id5">Analyze the results</a></p>
<ul>
<li><p><a class="reference internal" href="#kernelshark-using-windows-subsystem-for-linux-wsl" id="id6">Kernelshark using Windows Subsystem for Linux (WSL)</a></p></li>
<li><p><a class="reference internal" href="#labview-threads" id="id7">LabVIEW Threads</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-information-and-resources" id="id8">Additional information and resources</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>When debugging latency issues, race conditions, or hangs on real-time embedded targets, it is useful to know what the kernel/OS was doing just prior to the error condition. Acquiring and analyzing a kernel event or function trace can provide insights into latency spikes, race conditions, lock contention, priority inversions, missed loop iterations and so on.</p>
<p>This document covers using the kernel ftrace system.</p>
</section>
<section id="ftrace">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">ftrace</a><a class="headerlink" href="#ftrace" title="Link to this heading">¶</a></h2>
<p>On NILRT systems the kernel debugfs is mounted at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug</span></code>. The ftrace subsystem can be controlled via pseudo-files at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing</span></code>. For a quick description of the configuration knobs available, see <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing/README</span></code>.</p>
<p>Below is the typical sequence to start an <em>event trace</em> from an SSH/serial terminal prompt. The same operations can be performed via file read/writes from other programming languages, including LabVIEW.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Files under <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing</span></code> are text files, use appropriate LabVIEW primitives when accessing them.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tracing is a privileged operation. On older versions of NILRT (2025Q1 and earlier), file ownership and/or permissions have to be adjusted when used from LabVIEW; e.g., with <code class="docutils literal notranslate"><span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">lvuser:ni</span> <span class="pre">/sys/kernel/debug/tracing</span></code>. This change will not persist across a reboot.</p>
</div>
<ol class="arabic">
<li><p>Stop any ongoing tracing and clear the buffer.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/tracing_on
<span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/trace
</pre></div>
</div>
</li>
<li><p>Enable tracing for all events.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/events/enable
</pre></div>
</div>
</li>
<li><p>Start tracing.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/tracing_on
</pre></div>
</div>
</li>
<li><p>(optional) Add custom markers to the trace.</p>
<p>Custom markers can be added into the trace to track the application progress by writing into the trace_marker file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;something happened&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/trace_marker
</pre></div>
</div>
<p>Use this with caution and sparingly. Writing to the trace buffer adds additional latency.</p>
</li>
<li><p>Stop tracing.</p>
<p>Trace events are written to a circular buffer, so newer trace contents overwrite older trace contents. Stop tracing as soon as possible after the event of interest to ensure important trace information is not lost.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/tracing_on
</pre></div>
</div>
</li>
</ol>
</section>
<section id="extract-the-trace">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Extract the trace</a><a class="headerlink" href="#extract-the-trace" title="Link to this heading">¶</a></h2>
<p>The resulting trace can be extracted to a binary file with <code class="docutils literal notranslate"><span class="pre">trace-cmd</span></code> which can be installed from packages feeds with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>opkg<span class="w"> </span>install<span class="w"> </span>trace-cmd
</pre></div>
</div>
<p>To extract the trace to the default filename <code class="docutils literal notranslate"><span class="pre">trace.dat</span></code>, use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>trace-cmd<span class="w"> </span>extract
</pre></div>
</div>
<p>Alternatively, the trace can instead be extracted in a human readable textual representation using the following command. Extracting the trace can be a slow operation if it is large.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/sys/kernel/debug/tracing/trace<span class="w"> </span>&gt;<span class="w"> </span>trace.txt
</pre></div>
</div>
</section>
<section id="analyze-the-results">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Analyze the results</a><a class="headerlink" href="#analyze-the-results" title="Link to this heading">¶</a></h2>
<p>A resulting binary trace file can then be loaded in the front-end GUI tool Kernelshark for off-target analysis.</p>
<blockquote>
<div><img alt="../_images/trace-loaded-in-kernelshark.png" src="../_images/trace-loaded-in-kernelshark.png" />
</div></blockquote>
<p>Kernelshark can be used on a Linux desktop distribution or on Windows using the Windows Subsystem for Linux (WSL).</p>
<section id="kernelshark-using-windows-subsystem-for-linux-wsl">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Kernelshark using Windows Subsystem for Linux (WSL)</a><a class="headerlink" href="#kernelshark-using-windows-subsystem-for-linux-wsl" title="Link to this heading">¶</a></h3>
<p>Kernelshark is a Linux application. You can run it on a native Linux desktop installation or a virtual machine installation. If you would like to run Kernelshark from within a Windows desktop environment, you can do so using the Windows Subsystem for Linux (WSL).</p>
<p>A complete guide to installing and using WSL is outside the scope of this document. However, the following steps show the general process to install and use Kernelshark. For more information, see the <a class="reference external" href="https://learn.microsoft.com/en-us/windows/wsl/install">Microsoft documentation</a>.</p>
<ol class="arabic">
<li><p>Install WSL</p>
<p>From Powershell or Command Prompt run in administrator mode:</p>
<div class="highlight-batch notranslate"><div class="highlight"><pre><span></span>wsl --install
</pre></div>
</div>
<p>This command installs the default Linux distribution. The remaining instructions assume Ubuntu, but the instructions are similar for other distributions.</p>
</li>
<li><p>Restart Windows</p></li>
<li><p>Launch Ubuntu</p>
<p>Ubuntu should now be present in your Windows start menu. Select it to launch Ubuntu. This will open a shell window. There will be a delay as Windows downloads and installs your Linux distribution. You will select a username and password for your account in the Linux distribution.</p>
</li>
<li><p>Install Kernelshark</p>
<p>In the shell window, run each of the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>kernelshark
</pre></div>
</div>
<p>If you are using a different Linux distribution with a package manager other than <code class="docutils literal notranslate"><span class="pre">apt</span></code> the commands will be different.</p>
</li>
<li><p>Launch Kernelshark</p>
<p>Kernelshark should now be present in your Windows start menu. Select it to launch Kernelshark.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>With some graphics hardware/driver configurations, Kernelshark might open with an empty black window. In this case, you can run Kernelshark with software rendering as a workaround. To do so, run the following command from the Linux shell.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">LIBGL_ALWAYS_SOFTWARE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>kernelshark
</pre></div>
</div>
</div>
</li>
<li><p>Copy the trace file</p>
<p>Use your preferred method to copy the trace file from your target to Windows or to your Linux distribution running in WSL. Common methods include scp, ssh, FTP, etc.</p>
</li>
<li><p>Open the trace file</p>
<p>Using the File menu in Kernelshark, choose to open a trace file. If the trace file is located on the Linux distribution running in WSL, then it should be found at the expected location. If the trace file is located on Windows, you can find it on the appropriate drive under the path <code class="docutils literal notranslate"><span class="pre">/mnt/&lt;drive_letter&gt;</span></code>.</p>
</li>
</ol>
</section>
<section id="labview-threads">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">LabVIEW Threads</a><a class="headerlink" href="#labview-threads" title="Link to this heading">¶</a></h3>
<p>The trace will contain threads created by the LabVIEW Real-Time process (lvrt).
The full list of these threads can be obtained by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/proc/<span class="k">$(</span>pidof<span class="w"> </span>lvrt<span class="k">)</span>/task/*/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Name
</pre></div>
</div>
<p>Some common threads are</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">LabVIEW Real-Time threads</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Thread Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MainAppThread</p></td>
<td><p>A thread that handles front panel communication.</p></td>
</tr>
<tr class="row-odd"><td><p>LV_Occurrence</p></td>
<td><p>A thread that handles LV Occurances (e.g. software interrupts).</p></td>
</tr>
<tr class="row-even"><td><p>LV_Socket_Mon</p></td>
<td><p>A thread that handles socket (TCP and UDP) traffic.</p></td>
</tr>
<tr class="row-odd"><td><p>LV_Countdown</p></td>
<td><p>A thread that controls scheduling of UI thread.</p></td>
</tr>
<tr class="row-even"><td><p>LV_ESys2_Thr*</p></td>
<td><p>Worker threads used to run parts of LabVIEW diagrams.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Timed Loop</em></p></td>
<td><p>A thread that handles timed loop whose name is user defined by Timed Loop’s Input Node <cite>Structure Name</cite> field.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="additional-information-and-resources">
<h2><a class="toc-backref" href="#id8" role="doc-backlink">Additional information and resources</a><a class="headerlink" href="#additional-information-and-resources" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.kernel.org/doc/html/latest/trace/index.html">Linux Tracing Technologies</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/365835/">Debugging the kernel using Ftrace - part 1</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/366796/">Debugging the kernel using Ftrace - part 2</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/410200/">trace-cmd: A front-end for Ftrace</a></p></li>
<li><p><a class="reference external" href="https://kernelshark.org/Documentation.html">KernelShark documentation</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/425583/">Using KernelShark to analyze the real-time scheduler</a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Tracing on NI Linux Real-Time</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#ftrace">ftrace</a></li>
<li><a class="reference internal" href="#extract-the-trace">Extract the trace</a></li>
<li><a class="reference internal" href="#analyze-the-results">Analyze the results</a><ul>
<li><a class="reference internal" href="#kernelshark-using-windows-subsystem-for-linux-wsl">Kernelshark using Windows Subsystem for Linux (WSL)</a></li>
<li><a class="reference internal" href="#labview-threads">LabVIEW Threads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-information-and-resources">Additional information and resources</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="technicalreport.html"
                          title="previous chapter">Technical Support Report</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../system_replication/system_replication.html"
                          title="next chapter">USB-Based System Replication</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>GitHub Source</h3>
    <ul class="this-page-menu">
      <li><a href="https://github.com/ni/nilrt-docs/"
            rel="nofollow">Source on GitHub</a></li>
      <li><a href="https://github.com/ni/nilrt-docs/blob/main/docs/source/troubleshooting/tracing.rst"
            rel="nofollow">Show Document Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../system_replication/system_replication.html" title="USB-Based System Replication"
             >next</a> |</li>
        <li class="right" >
          <a href="technicalreport.html" title="Technical Support Report"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="troubleshooting_index.html" >NI Linux Real-Time Debug Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing on NI Linux Real-Time</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright NI.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>