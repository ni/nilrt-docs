

<!doctype html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>NI Linux Real-Time and opkg: Distributing Packages &#8212; nilrt-docs 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NI Linux Real-Time and opkg: Distributing DKMS-based Kernel Modules" href="dkms_opkg.html" />
    <link rel="prev" title="Opkg Package System Tutorials" href="opkg_tutorials_index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="dkms_opkg.html" title="NI Linux Real-Time and opkg: Distributing DKMS-based Kernel Modules"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="opkg_tutorials_index.html" title="Opkg Package System Tutorials"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="opkg_tutorials_index.html" accesskey="U">Opkg Package System Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">NI Linux Real-Time and opkg: Distributing Packages</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="ni-linux-real-time-and-opkg-distributing-packages">
<h1>NI Linux Real-Time and opkg: Distributing Packages<a class="headerlink" href="#ni-linux-real-time-and-opkg-distributing-packages" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id1">Introduction</a></p>
<ul>
<li><p><a class="reference internal" href="#a-note-on-support" id="id2">A Note on Support</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id3">Requirements</a></p></li>
<li><p><a class="reference internal" href="#opkg" id="id4">Opkg</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#configuring-the-system" id="id5">Configuring the System</a></p></li>
<li><p><a class="reference internal" href="#source-files" id="id6">Source Files</a></p>
<ul>
<li><p><a class="reference internal" href="#helloworld-c" id="id7">helloworld.c</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-the-package-file" id="id8">Creating the Package File</a></p>
<ul>
<li><p><a class="reference internal" href="#directory-structure" id="id9">Directory Structure</a></p></li>
<li><p><a class="reference internal" href="#control-file" id="id10">Control File</a></p></li>
<li><p><a class="reference internal" href="#the-debian-binary-file" id="id11">The debian-binary File</a></p></li>
<li><p><a class="reference internal" href="#scripts" id="id12">Scripts</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-the-package" id="id13">Building the Package</a></p></li>
<li><p><a class="reference internal" href="#building-the-feed" id="id14">Building the Feed</a></p></li>
<li><p><a class="reference internal" href="#a-note-for-more-general-use-cases" id="id15">A Note for More General Use Cases</a></p></li>
<li><p><a class="reference internal" href="#resources" id="id16">Resources</a></p></li>
</ul>
</div>
<section id="introduction">
<h2><a class="toc-backref" href="#id1">Introduction</a><a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Oftentimes it can be desirable to extend the functionality provided by
the Linux kernel and have access to other custom packages. This document
will discuss how to create, package, and test loadable packages with NI
Linux Real-Time.</p>
<section id="a-note-on-support">
<h3><a class="toc-backref" href="#id2">A Note on Support</a><a class="headerlink" href="#a-note-on-support" title="Permalink to this headline">¶</a></h3>
<p>This document is meant as a walkthrough of general Linux concepts within
NI Linux Real-Time. As these concepts are general to any Linux system
and the open source software used, NI Support will not provide
assistance through Technical Support channels should problems be
encountered. NI does not provide official support for modifying the
kernel such as through the addition of loadable kernel modules. For more
information on how NI provides support for NI Linux Real-Time, refer to
the <a class="reference external" href="https://forums.ni.com/t5/NI-Linux-Real-Time-Documents/NI-Linux-Real-Time-FAQ/ta-p/3495630">NI Linux Real-Time
FAQ</a>.
If problems are encountered, posting to the <a class="reference external" href="https://forums.ni.com/t5/NI-Linux-Real-Time/ct-p/7013">NI Linux Real-Time
Community</a> or
other Linux discussion boards is the recommended way to get further
guidance.</p>
</section>
<section id="requirements">
<h3><a class="toc-backref" href="#id3">Requirements</a><a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<p>The following software and hardware are required to follow this
tutorial:</p>
<ul class="simple">
<li><p>NI Linux Real-Time System with one of the following access to the
online NI Repositories</p></li>
<li><p>Source for a Linux Package</p>
<ul>
<li><p>NI recommends using the “Hello, World!” source <a class="reference download internal" download="" href="../_downloads/11897079cc33b96d2e508c21ecfd34a9/opkg_intro.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">available</span> <span class="pre">here</span></code></a> for this
tutorial, however one can use your own source or even pre-built
shared libraries.</p></li>
</ul>
</li>
</ul>
</section>
<section id="opkg">
<h3><a class="toc-backref" href="#id4">Opkg</a><a class="headerlink" href="#opkg" title="Permalink to this headline">¶</a></h3>
<p>Opkg is a light-weight package manager which uses the *.ipk format to
install and manage packages on a filesystem. While slightly different,
*.ipks are very similar to *.deb packages and are based on that
standard. Due to the lightweight nature of opkg and its basis on a
standard Linux package type, NI chose to use opkg as the package manager
for NI Linux Real-Time.</p>
<p>This tutorial will cover the steps needed to use the <strong>opkg</strong> and
<strong>opkg-build</strong> commands to create a package for distribution. *.ipks
can be created on any system with <strong>opkg-build</strong> installed. For
simplicity, this tutorial uses a Linux Real-Time system. For more
information on opkg, refer to the official documentation.</p>
</section>
</section>
<section id="configuring-the-system">
<h2><a class="toc-backref" href="#id5">Configuring the System</a><a class="headerlink" href="#configuring-the-system" title="Permalink to this headline">¶</a></h2>
<p>Before starting, the required software and toolchains must be installed
to the NI Linux Real-Time system used. This can be accomplished through
console access to the device via a serial port, SSH, or direct access
via a keyboard and monitor. For the screenshots in this tutorial, SSH is
used via <a class="reference external" href="https://www.putty.org/">PuTTY</a>.</p>
<ol class="arabic">
<li><p>Open a console to the NI Linux Real-Time system and log in as or
switch to the <strong>admin</strong> user.</p></li>
<li><p>Run the <strong>opkg update</strong> command to refresh the list of available
packages.
.. code:: bash</p>
<blockquote>
<div><p>opkg update</p>
</div></blockquote>
</li>
<li><p>Install the <strong>opkg-utils</strong> package to install the required tools for
creating *.ipks.
.. code:: bash</p>
<blockquote>
<div><p>opkg install opkg-utils</p>
</div></blockquote>
</li>
<li><p>Confirm that the installation completed successfully.</p></li>
</ol>
</section>
<section id="source-files">
<h2><a class="toc-backref" href="#id6">Source Files</a><a class="headerlink" href="#source-files" title="Permalink to this headline">¶</a></h2>
<p>To demonstrate building and testing a package, this tutorial will use a
simple “Hello, World!” example. While this same process will apply to
any package, NI recommends walking through the process for this simple
module before moving to more complex designs.</p>
<p>The <a class="reference download internal" download="" href="../_downloads/11897079cc33b96d2e508c21ecfd34a9/opkg_intro.tar.gz"><code class="xref download docutils literal notranslate"><span class="pre">source</span> <span class="pre">for</span> <span class="pre">this</span> <span class="pre">“Hello,</span> <span class="pre">World!”</span> <span class="pre">package</span></code></a> will consist of three main
files:</p>
<ul class="simple">
<li><p><em>helloworld.c</em> – The C source code</p></li>
<li><p><em>CONTROL</em> - The control file for the package</p></li>
<li><p><em>debain-binary</em> - The debian-binary file</p></li>
</ul>
<section id="helloworld-c">
<span id="helloworldc"></span><h3><a class="toc-backref" href="#id7">helloworld.c</a><a class="headerlink" href="#helloworld-c" title="Permalink to this headline">¶</a></h3>
<p>This is C source code for a simple “Hello, World!” program.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello, World!!! </span><span class="se">\\</span><span class="s">n&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>If you want to compile the source on the target, you could do so using
the gcc toolchain:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>gcc –o hello helloworld.c
</pre></div>
</div>
<p>Note: if you are following this tutorial and compiling on target, make
sure to install the compile tools which will allow you to use gcc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>opkg install gcc binutils gcc-symlinks
</pre></div>
</div>
<p>At this point, you now have an executable called <em>hello</em>.</p>
</section>
</section>
<section id="creating-the-package-file">
<h2><a class="toc-backref" href="#id8">Creating the Package File</a><a class="headerlink" href="#creating-the-package-file" title="Permalink to this headline">¶</a></h2>
<p>With the source in hand, the next step is to package it into an *.ipk
for redistribution. As mentioned previously, *.ipks are very similar to
*.deb packages and are based on that standard. For more information on
creating *.ipks and the options for doing so, NI recommends referring
to the official documentation for opkg and opkg-build.</p>
<section id="directory-structure">
<h3><a class="toc-backref" href="#id9">Directory Structure</a><a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h3>
<p>To create an *.ipk file, everything must be in the proper directory
structure. For this tutorial the following directory structure will be
used.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>hellopkg
|-- CONTROL
|   `-- control
|-- debian-binary
`-- usr
    |-- bin
    |   `-- hello
    `-- lib
</pre></div>
</div>
<p>This mirrors the final structure contained in the built package, which
is simply a special compressed form of that directory structure. As
covered in the official opkg documentation, an *.ipk requires a few
things with the other items being optional:</p>
<ol class="arabic simple">
<li><p>A <em>CONTROL</em> directory with a <em>control</em> file.
<strong>Note:</strong> Keep in mind that Linux is case sensitive.</p></li>
<li><p>The data files to be installed in their proper directory structure.</p></li>
</ol>
<p>The optional components required for a package are:</p>
<ol class="arabic simple">
<li><p>A <em>postinst</em> script, to register the kernel module with DKMS
following the installation.</p></li>
<li><p>A <em>prerm</em> script, to remove and unregister the kernel module from
DKMS prior to removal.</p></li>
</ol>
<p>For more information on *.ipks and these files, refer to the official
documentation and man pages for opkg. To proceed with this tutorial,
recreate the file structure shown above on the NI Linux Real-Time system
with the files provided for this tutorial.</p>
</section>
<section id="control-file">
<h3><a class="toc-backref" href="#id10">Control File</a><a class="headerlink" href="#control-file" title="Permalink to this headline">¶</a></h3>
<p>The control file describes the package’s dependencies, maintainer, name,
version, and other information required by opkg to ensure proper
installation. Much of this information will also be returned if the
<strong>opkg info</strong> command is run on a built or installed package.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Package</span><span class="p">:</span> <span class="n">hellopkg</span>
<span class="n">Version</span><span class="p">:</span> <span class="mf">1.0.0</span>
<span class="n">Architecture</span><span class="p">:</span> <span class="n">x64</span>
<span class="n">Maintainer</span><span class="p">:</span> <span class="s2">&quot;somebody&quot;</span> <span class="o">&lt;</span><span class="n">somebody</span><span class="nd">@somewhere</span><span class="o">.</span><span class="n">com</span><span class="o">&gt;</span>
<span class="n">Description</span><span class="p">:</span> <span class="n">hello</span> <span class="n">world</span>
<span class="n">Source</span><span class="p">:</span> <span class="n">helloworld</span><span class="o">.</span><span class="n">c</span>
<span class="n">Priority</span><span class="p">:</span> <span class="n">optional</span>
<span class="n">Section</span><span class="p">:</span> <span class="n">libs</span>
</pre></div>
</div>
</section>
<section id="the-debian-binary-file">
<h3><a class="toc-backref" href="#id11">The debian-binary File</a><a class="headerlink" href="#the-debian-binary-file" title="Permalink to this headline">¶</a></h3>
<p>This file should be a text file containing only the following line, as
described by the *.ipk standard.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">2.0</span>
</pre></div>
</div>
</section>
<section id="scripts">
<h3><a class="toc-backref" href="#id12">Scripts</a><a class="headerlink" href="#scripts" title="Permalink to this headline">¶</a></h3>
<p>As mentioned previously, there are two optional scripts when creating
*.ipk files for installing packages. These scripts handle the
registration, installation, and removal of files during installation and
removal of the package.</p>
<p><strong>Note:</strong> In order to build a package, all scripts must have executable
privileges. To ensure that this is the case, run <strong>chmod a+x &lt;script&gt;</strong>
before attempting to build a package.</p>
<section id="preinst">
<h4>preinst<a class="headerlink" href="#preinst" title="Permalink to this headline">¶</a></h4>
<p>The preinst script will be run before the installation of the package
files.</p>
</section>
<section id="postinst">
<h4>postinst<a class="headerlink" href="#postinst" title="Permalink to this headline">¶</a></h4>
<p>The postinst script will be run upon finishing the installation of the
package files.</p>
</section>
<section id="premrm">
<h4>premrm<a class="headerlink" href="#premrm" title="Permalink to this headline">¶</a></h4>
<p>The <em>prerm</em> script will be run by opkg before any files are removed
during package removal.</p>
</section>
<section id="postrm">
<h4>postrm<a class="headerlink" href="#postrm" title="Permalink to this headline">¶</a></h4>
<p>The <em>postrm</em> script will be run by opkg after files are removed during
package removal.</p>
</section>
</section>
</section>
<section id="building-the-package">
<h2><a class="toc-backref" href="#id13">Building the Package</a><a class="headerlink" href="#building-the-package" title="Permalink to this headline">¶</a></h2>
<p>Once the directory structure is in place, all that’s necessary is to
build them into an *.ipk package.</p>
<ol class="arabic simple">
<li><p>Change directories to the directory containing the top-level
directory for the package. In this case, the directory containing the
<em>hellopkg/</em> directory.</p></li>
<li><p>Run the <strong>opkg-build</strong> command on the package directory.</p></li>
<li><p>Confirm that the *.ipk file is now present.</p></li>
</ol>
</section>
<section id="building-the-feed">
<h2><a class="toc-backref" href="#id14">Building the Feed</a><a class="headerlink" href="#building-the-feed" title="Permalink to this headline">¶</a></h2>
<p>If you wish to turn the directory into a feed, you can perform the
following step to generate Packages and Packages.gz files.</p>
<ol class="arabic simple">
<li><p>Run <strong>opkg-make-index –p Packages Packages</strong></p></li>
<li><p>From there, you can put these files onto a HTTP/S web server to
access the feed remotely.</p></li>
</ol>
<p>At this point, NI recommends testing the package on a different system
from the one it was originally built on or testing by formatting the
system used to create the *.ipk and installing from scratch. You can
simply transfer the ipk to the target, and then install it using opkg.</p>
</section>
<section id="a-note-for-more-general-use-cases">
<h2><a class="toc-backref" href="#id15">A Note for More General Use Cases</a><a class="headerlink" href="#a-note-for-more-general-use-cases" title="Permalink to this headline">¶</a></h2>
<p>The tutorial above just walked through the steps for building an ipk
that includes a Hello World executable. If you want to apply this to an
ipk that will include various shared libraries, you can still follow the
steps above, and use the tree structure. For example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>examplepkg
|-- CONTROL
|   `-- control
`-- usr
    |-- bin
    |   `-- exampleexe
    `-- lib
        `-- example.so
</pre></div>
</div>
<p>Once you have the tree structure in place, you can follow the rest of
the steps in the tutorial. For installing from the OS package manager,
it is best practice to install shared libraries to /usr/ directories. It
is best practice to use /usr/local/ for things not managed by opkg</p>
</section>
<section id="resources">
<h2><a class="toc-backref" href="#id16">Resources</a><a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://forums.ni.com/t5/NI-Linux-Real-Time/ct-p/7013?profile.language=en">NI Linux Real-Time Community and Discussion
Forums</a></p></li>
<li><p><a class="reference external" href="https://forums.ni.com/t5/NI-Linux-Real-Time-Documents/NI-Linux-Real-Time-FAQ/ta-p/3495630?profile.language=en">NI Linux Real-Time
FAQ</a></p></li>
<li><p><a class="reference external" href="https://www.tldp.org/LDP/lkmpg/2.6/html/">The Linux Kernel Module Programming
Guide</a></p></li>
<li><p><a class="reference external" href="https://github.com/dell/dkms">Dynamic Kernel Module Support
source</a></p></li>
<li><p><a class="reference external" href="https://www.putty.org/">Putty</a></p></li>
<li><p><a class="reference external" href="http://www.ni.com/tutorial/14625/en/">Getting Started with C/C++ Development Tools for NI Linux Real-Time,
Eclipse Edition</a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">NI Linux Real-Time and opkg: Distributing Packages</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#a-note-on-support">A Note on Support</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#opkg">Opkg</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configuring-the-system">Configuring the System</a></li>
<li><a class="reference internal" href="#source-files">Source Files</a><ul>
<li><a class="reference internal" href="#helloworld-c">helloworld.c</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-the-package-file">Creating the Package File</a><ul>
<li><a class="reference internal" href="#directory-structure">Directory Structure</a></li>
<li><a class="reference internal" href="#control-file">Control File</a></li>
<li><a class="reference internal" href="#the-debian-binary-file">The debian-binary File</a></li>
<li><a class="reference internal" href="#scripts">Scripts</a><ul>
<li><a class="reference internal" href="#preinst">preinst</a></li>
<li><a class="reference internal" href="#postinst">postinst</a></li>
<li><a class="reference internal" href="#premrm">premrm</a></li>
<li><a class="reference internal" href="#postrm">postrm</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#building-the-package">Building the Package</a></li>
<li><a class="reference internal" href="#building-the-feed">Building the Feed</a></li>
<li><a class="reference internal" href="#a-note-for-more-general-use-cases">A Note for More General Use Cases</a></li>
<li><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="opkg_tutorials_index.html"
                          title="previous chapter">Opkg Package System Tutorials</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="dkms_opkg.html"
                          title="next chapter">NI Linux Real-Time and opkg: Distributing DKMS-based Kernel Modules</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/opkg/opkg_intro.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="dkms_opkg.html" title="NI Linux Real-Time and opkg: Distributing DKMS-based Kernel Modules"
             >next</a> |</li>
        <li class="right" >
          <a href="opkg_tutorials_index.html" title="Opkg Package System Tutorials"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="opkg_tutorials_index.html" >Opkg Package System Tutorials</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">NI Linux Real-Time and opkg: Distributing Packages</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright NI.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>