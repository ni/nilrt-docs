
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tracing on NI Linux Real-Time &#8212; nilrt-docs 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d75fae25" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=5283bb3d" />
    
    <script src="../_static/documentation_options.js?v=a681ed88"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="USB-Based System Replication" href="../system_replication/system_replication.html" />
    <link rel="prev" title="Obtaining Kernel Logs from a Prior System Crash Via pstore" href="pstore.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../system_replication/system_replication.html" title="USB-Based System Replication"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="pstore.html" title="Obtaining Kernel Logs from a Prior System Crash Via pstore"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="troubleshooting_index.html" accesskey="U">NI Linux Real-Time Debug Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing on NI Linux Real-Time</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tracing-on-ni-linux-real-time">
<h1>Tracing on NI Linux Real-Time<a class="headerlink" href="#tracing-on-ni-linux-real-time" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#introduction" id="id2">Introduction</a></p></li>
<li><p><a class="reference internal" href="#ftrace" id="id3">ftrace</a></p></li>
<li><p><a class="reference internal" href="#analyzing-the-results" id="id4">Analyzing the results</a></p>
<ul>
<li><p><a class="reference internal" href="#labview-threads" id="id5">LabVIEW Threads</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#additional-information-and-resources" id="id6">Additional information and resources</a></p></li>
</ul>
</nav>
<section id="introduction">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Introduction</a><a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>When debugging latency issues, race conditions, or hangs on real-time embedded targets, it is useful to know what the kernel/OS was doing just prior to the error condition. Acquiring and analyzing a kernel event or function trace can provide insights into latency spikes, race conditions, lock contention, priority inversions, missed loop iterations and so on.</p>
<p>This document covers using the kernel ftrace system.</p>
</section>
<section id="ftrace">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">ftrace</a><a class="headerlink" href="#ftrace" title="Link to this heading">¶</a></h2>
<p>On NILRT systems the kernel debugfs is mounted at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug</span></code>. The ftrace subsystem can be controlled via pseudo-files at <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing</span></code>. For a quick description of the configuration knobs available, see <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing/README</span></code>.</p>
<p>Below is the typical sequence to start an <em>event trace</em> from an SSH/serial terminal prompt. The same operations can be performed via file read/writes from other programming languages, including LabVIEW.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Files under <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing</span></code> are text files, use appropriate LabVIEW primitives when accessing them.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Tracing is a privileged operation. On older versions of NILRT (2025Q1 and earlier), file ownership and/or permissions have to be adjusted when used from LabVIEW; e.g., with <code class="docutils literal notranslate"><span class="pre">chown</span> <span class="pre">-R</span> <span class="pre">lvuser:ni</span> <span class="pre">/sys/kernel/debug/tracing</span></code>. This change will not persist across a reboot.</p>
</div>
<ol class="arabic">
<li><p>Stop any ongoing tracing and clear the buffer.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/tracing_on
<span class="nb">echo</span><span class="w"> </span><span class="m">0</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/trace
</pre></div>
</div>
</li>
<li><p>Enable tracing for all events.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/events/enable
</pre></div>
</div>
</li>
<li><p>Start tracing.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/tracing_on
</pre></div>
</div>
</li>
<li><p>(optional) Add custom markers to the trace.</p>
<p>Custom markers can be added into the trace to track the application progress by writing into the trace_marker file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;something happened&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/kernel/debug/tracing/trace_marker
</pre></div>
</div>
<p>Use this with caution and sparingly. Writing to the trace buffer adds additional latency.</p>
</li>
</ol>
</section>
<section id="analyzing-the-results">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Analyzing the results</a><a class="headerlink" href="#analyzing-the-results" title="Link to this heading">¶</a></h2>
<p>The resulting trace can be extracted with <code class="docutils literal notranslate"><span class="pre">trace-cmd</span></code> which can be installed from packages feeds with</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>opkg<span class="w"> </span>install<span class="w"> </span>trace-cmd
</pre></div>
</div>
<p>To extract the trace, use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>trace-cmd<span class="w"> </span>extract
</pre></div>
</div>
<p>The resulting trace file <code class="docutils literal notranslate"><span class="pre">trace.dat</span></code> can then be loaded in the front-end GUI tool <code class="docutils literal notranslate"><span class="pre">kernelshark</span></code> for off-target analysis.</p>
<blockquote>
<div><img alt="../_images/trace-loaded-in-kernelshark.png" src="../_images/trace-loaded-in-kernelshark.png" />
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">kernelshark</span></code> can be used on a Linux desktop distribution or on Windows with Windows Subsystem for Linux (WSL).</p>
<p>Alternatively, trace can also be extracted by reading <code class="docutils literal notranslate"><span class="pre">/sys/kernel/debug/tracing/trace</span></code> file directly. This will output a human readable textual representation. Reading the trace can be a slow operation, if it is large.</p>
<section id="labview-threads">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">LabVIEW Threads</a><a class="headerlink" href="#labview-threads" title="Link to this heading">¶</a></h3>
<p>The trace will contain threads created by LabVIEW Real-Time process (lvrt).
The full list of these threads can be obtained by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat<span class="w"> </span>/proc/<span class="k">$(</span>pidof<span class="w"> </span>lvrt<span class="k">)</span>/task/*/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Name
</pre></div>
</div>
<p>Some common threads are</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">LabVIEW Real-Time threads</span><a class="headerlink" href="#id1" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Thread Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MainAppThread</p></td>
<td><p>A thread that handles front panel communication.</p></td>
</tr>
<tr class="row-odd"><td><p>LV_Occurrence</p></td>
<td><p>A thread that handles LV Occurances (e.g. software interrupts).</p></td>
</tr>
<tr class="row-even"><td><p>LV_Socket_Mon</p></td>
<td><p>A thread that handles socket (TCP and UDP) traffic.</p></td>
</tr>
<tr class="row-odd"><td><p>LV_Countdown</p></td>
<td><p>A thread that controls scheduling of UI thread.</p></td>
</tr>
<tr class="row-even"><td><p>LV_ESys2_Thr*</p></td>
<td><p>Worker threads used to run parts of LabVIEW diagrams.</p></td>
</tr>
<tr class="row-odd"><td><p><em>Timed Loop</em></p></td>
<td><p>A thread that handles timed loop whose name is user defined by Timed Loop’s Input Node <cite>Structure Name</cite> field.</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="additional-information-and-resources">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Additional information and resources</a><a class="headerlink" href="#additional-information-and-resources" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.kernel.org/doc/html/latest/trace/index.html">Linux Tracing Technologies</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/365835/">Debugging the kernel using Ftrace - part 1</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/366796/">Debugging the kernel using Ftrace - part 2</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/410200/">trace-cmd: A front-end for Ftrace</a></p></li>
<li><p><a class="reference external" href="https://kernelshark.org/Documentation.html">KernelShark documentation</a></p></li>
<li><p><a class="reference external" href="https://lwn.net/Articles/425583/">Using KernelShark to analyze the real-time scheduler</a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Tracing on NI Linux Real-Time</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#ftrace">ftrace</a></li>
<li><a class="reference internal" href="#analyzing-the-results">Analyzing the results</a><ul>
<li><a class="reference internal" href="#labview-threads">LabVIEW Threads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-information-and-resources">Additional information and resources</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="pstore.html"
                          title="previous chapter">Obtaining Kernel Logs from a Prior System Crash Via pstore</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../system_replication/system_replication.html"
                          title="next chapter">USB-Based System Replication</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>GitHub Source</h3>
    <ul class="this-page-menu">
      <li><a href="https://github.com/ni/nilrt-docs/"
            rel="nofollow">Source on GitHub</a></li>
      <li><a href="https://github.com/ni/nilrt-docs/blob/main/docs/source/troubleshooting/tracing.rst"
            rel="nofollow">Show Document Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../system_replication/system_replication.html" title="USB-Based System Replication"
             >next</a> |</li>
        <li class="right" >
          <a href="pstore.html" title="Obtaining Kernel Logs from a Prior System Crash Via pstore"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">nilrt-docs 1.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="troubleshooting_index.html" >NI Linux Real-Time Debug Documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tracing on NI Linux Real-Time</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright NI.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>
  </body>
</html>